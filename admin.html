<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>åšå®¢åå°ç®¡ç†</title>
    <style>
        /* åŸºç¡€æ ·å¼ + æ˜Ÿç©ºèƒŒæ™¯æ ¸å¿ƒæ ·å¼ */
        body {
            background: #0a0a0f;
            color: #fff;
            padding: 30px;
            font-family: sans-serif;
            min-height: 100vh;
            /* å…¨å±é«˜åº¦ */
            position: relative;
            /* è®©æ˜Ÿç©ºå®¹å™¨å®šä½ç”Ÿæ•ˆ */
            overflow-x: hidden;
            /* éšè—æ¨ªå‘æ»šåŠ¨ */
            margin: 0;
            /* æ¸…é™¤é»˜è®¤è¾¹è· */
        }

        /* æ˜Ÿç©ºå®¹å™¨ - é™æ€æ˜Ÿæ˜Ÿå±‚ */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            /* æœ€åº•å±‚ */
            pointer-events: none;
            /* ä¸æ‹¦æˆªç‚¹å‡» */
            background: #050210 url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23050210"/><circle cx="10" cy="10" r="1" fill="%23fff" opacity="0.8"/><circle cx="30" cy="40" r="0.8" fill="%23fff" opacity="0.6"/><circle cx="60" cy="20" r="1.2" fill="%23fff" opacity="0.7"/><circle cx="80" cy="70" r="0.9" fill="%23fff" opacity="0.5"/><circle cx="40" cy="80" r="1" fill="%23fff" opacity="0.8"/></svg>') repeat;
            background-size: 300px 300px;
        }

        /* æ˜Ÿç©ºå®¹å™¨ - é—ªçƒæ˜Ÿæ˜Ÿå±‚ */
        .twinkling {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            /* é™æ€æ˜Ÿæ˜Ÿä¸Šå±‚ */
            pointer-events: none;
            /* ä¸æ‹¦æˆªç‚¹å‡» */
            background: transparent url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="20" cy="20" r="0.5" fill="%23fff" opacity="0.4"/><circle cx="50" cy="50" r="0.7" fill="%23fff" opacity="0.5"/><circle cx="80" cy="30" r="0.6" fill="%23fff" opacity="0.3"/><circle cx="40" cy="70" r="0.8" fill="%23fff" opacity="0.6"/><circle cx="70" cy="80" r="0.5" fill="%23fff" opacity="0.4"/></svg>') repeat;
            background-size: 200px 200px;
            animation: twinkle 25s linear infinite;
        }

        /* æ˜Ÿæ˜Ÿé—ªçƒåŠ¨ç”» */
        @keyframes twinkle {
            0% {
                transform: translate(30 30);
                opacity: 0.2;
            }

            50% {
                opacity: 0.9;
            }

            100% {
                transform: translate(30%, 30%);
                opacity: 0.5;
            }
        }

        /* è¡¨å•å…ƒç´ æ ·å¼ï¼ˆé€‚é…æ˜Ÿç©ºï¼‰ */
        input,
        textarea {
            width: 100%;
            margin: 8px 0;
            padding: 10px;
            background: rgba(18, 18, 24, 0.85);
            /* åŠé€æ˜ */
            border: 1px solid #333;
            color: #fff;
            border-radius: 4px;
            backdrop-filter: blur(2px);
            /* æ¯›ç»ç’ƒæ•ˆæœ */
        }

        button {
            background: #00f0ff;
            color: #000;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 6px;
            transition: background 0.3s;
            /*  hoverè¿‡æ¸¡ */
        }

        button:hover {
            background: #00d8e6;
            /* é¼ æ ‡æ‚¬æµ®é«˜äº® */
        }

        .item {
            background: rgba(18, 18, 24, 0.85);
            /* åŠé€æ˜ */
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            backdrop-filter: blur(2px);
            /* æ¯›ç»ç’ƒæ•ˆæœ */
        }

        #login {
            max-width: 350px;
            margin: 0 auto 30px;
            background: rgba(18, 18, 24, 0.9);
            /* ç™»å½•æ¡†æ›´ä¸é€æ˜ */
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        #admin {
            display: none;
            background: rgba(18, 18, 24, 0.1);
            padding: 20px;
            border-radius: 8px;
        }

        .img-preview {
            width: 150px;
            height: 100px;
            border: 1px dashed #333;
            margin: 8px 0;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #888;
            background-color: rgba(18, 18, 24, 0.5);
            /* é¢„è§ˆæ¡†åŠé€æ˜ */
        }

        .category-select {
            width: 100%;
            margin: 8px 0;
            padding: 10px;
            background: rgba(18, 18, 24, 0.85);
            /* åŠé€æ˜ */
            border: 1px solid #333;
            color: #fff;
            border-radius: 4px;
            backdrop-filter: blur(2px);
            /* æ¯›ç»ç’ƒæ•ˆæœ */

        }



        /* ////// */
        /* è‡ªå®šä¹‰åˆ é™¤ç¡®è®¤å¼¹çª— */
        .del-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .del-modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        .del-modal-content {
            background: rgba(18, 18, 24, 0.95);
            border-radius: 8px;
            padding: 25px;
            width: 90%;
            max-width: 400px;
            backdrop-filter: blur(8px);
            border: 1px solid #333;
            text-align: center;
        }

        .del-modal h3 {
            margin: 0 0 15px;
            color: #fff;
        }

        .del-modal-btns {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .del-modal-btn {
            padding: 8px 20px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }

        .del-confirm {
            background: #ff4444;
            color: #fff;
        }

        .del-confirm:hover {
            background: #cc0000;
        }

        .del-cancel {
            background: #666;
            color: #fff;
        }

        .del-cancel:hover {
            background: #444;
        }
    </style>
</head>

<body>
    <!-- æ–°å¢ï¼šæ˜Ÿç©ºèƒŒæ™¯å®¹å™¨ï¼ˆæ”¾åœ¨bodyæœ€é¡¶éƒ¨ï¼‰ -->
    <div class="stars"></div>
    <div class="twinkling"></div>

    <!-- åŸæœ‰ç™»å½•æ¡† -->
    <div id="login">
        <h2>åå°ç™»å½•</h2>
        <input id="pwd" placeholder="è¯·è¾“å…¥å¯†ç " type="password">
        <button onclick="login()">ç™»å½•</button>
    </div>

    <!-- åŸæœ‰ç®¡ç†åŒº -->
    <div id="admin">
        <h1>ğŸ“ å´ç¼åŒ Â· åšå®¢ç®¡ç†</h1>
        <input id="id" type="hidden">
        <input id="title" placeholder="æ–‡ç« æ ‡é¢˜">
        <input id="intro" placeholder="ç®€ä»‹">
        <!-- æ–°å¢åˆ†ç±»é€‰æ‹© -->
        <select id="category" class="category-select">
            <option value="ç”Ÿæ´»æ—¥å¸¸">ç”Ÿæ´»æ—¥å¸¸</option>
            <option value="æ—…æ¸¸æ¸¸è®°">æ—…æ¸¸æ¸¸è®°</option>
            <option value="ç¾é£Ÿåˆ†äº«">ç¾é£Ÿåˆ†äº«</option>
            <option value="å¼€å¿ƒä¸€åˆ»">å¼€å¿ƒä¸€åˆ»</option>
        </select>
        <!-- æ–°å¢æ–‡ç« å›¾ç‰‡ä¸Šä¼  -->
        <div>
            <h4>æ–‡ç« å›¾ç‰‡</h4>
            <input type="file" id="postImg" accept="image/*">
            <div class="img-preview" id="imgPreview">æš‚æ— å›¾ç‰‡</div>
        </div>
        <button onclick="save()">ä¿å­˜æ–‡ç« </button>
        <button onclick="clearForm()">æ¸…ç©º</button>
        <hr><br>
        <h3>ä¸Šä¼ å¤´åƒ</h3>
        <input type="file" id="avatar" accept="image/*">
        <button onclick="uploadAvatar()">ä¸Šä¼ å¤´åƒ</button>
        <hr><br>
        <h3>æ–‡ç« åˆ—è¡¨</h3>
        <div id="list"></div>

        <!-- ////// -->
        <!-- è‡ªå®šä¹‰åˆ é™¤ç¡®è®¤å¼¹çª— -->
        <div class="del-modal" id="delModal">
            <div class="del-modal-content">
                <h3>ç¡®è®¤åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿ</h3>
                <p style="color:#ccc;">åˆ é™¤åå°†æ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼</p>
                <div class="del-modal-btns">
                    <button class="del-modal-btn del-cancel" onclick="hideDelModal()">å–æ¶ˆ</button>
                    <button class="del-modal-btn del-confirm" onclick="confirmDelete()">ç¡®è®¤åˆ é™¤</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é»˜è®¤å¯†ç ï¼š123456
        function login() {
            const p = document.getElementById('pwd').value;
            if (p === '123456') {
                document.getElementById('login').style.display = 'none';
                document.getElementById('admin').style.display = 'block';
                loadList();
            } else {
                alert('å¯†ç é”™è¯¯');
            }
        }

        // é¢„è§ˆæ–‡ç« å›¾ç‰‡
        document.getElementById('postImg').addEventListener('change', function (e) {
            const file = e.target.files[0];
            const preview = document.getElementById('imgPreview');
            if (file) {
                const reader = new FileReader();
                reader.onload = function () {
                    preview.style.backgroundImage = `url(${reader.result})`;
                    preview.textContent = '';
                }
                reader.readAsDataURL(file);
            } else {
                preview.style.backgroundImage = '';
                preview.textContent = 'æš‚æ— å›¾ç‰‡';
            }
        });

        // ä¸Šä¼ æ–‡ç« å›¾ç‰‡ï¼ˆå•ç‹¬æ¥å£ï¼‰
        async function uploadPostImg(file) {
            if (!file) return '';
            const form = new FormData();
            form.append('postImg', file);
            const res = await fetch('/uploadPostImg', {
                method: 'POST',
                body: form
            });
            return await res.text(); // è¿”å›å›¾ç‰‡è·¯å¾„
        }

        // åŠ è½½æ–‡ç« 
        async function loadList() {
            const r = await fetch('/data.json');
            const d = await r.json();
            const list = document.getElementById('list');
            list.innerHTML = '';
            d.posts.forEach(p => {
                list.innerHTML += `
            <div class="item">
                <h4>${p.title}</h4>
                <p>åˆ†ç±»ï¼š${p.category}</p>
                <p>${p.date}</p>
                <button onclick="edit(${p.id})">ç¼–è¾‘</button>
                <button onclick="del(${p.id})">åˆ é™¤</button>
            </div>`;
            });
        }

        // ä¿å­˜/æ–°å¢
        async function save() {
            const id = document.getElementById('id').value || Date.now();
            const title = document.getElementById('title').value;
            const intro = document.getElementById('intro').value;
            const category = document.getElementById('category').value;
            const date = new Date().toLocaleDateString();
            const postImgFile = document.getElementById('postImg').files[0];

            // ä¸Šä¼ æ–‡ç« å›¾ç‰‡ï¼ˆå¦‚æœæœ‰ï¼‰
            let imgUrl = '';
            if (postImgFile) {
                imgUrl = await uploadPostImg(postImgFile);
            }

            const res = await fetch('/data.json');
            const data = await res.json();

            const index = data.posts.findIndex(x => x.id == id);
            if (index >= 0) {
                // ç¼–è¾‘æ—¶ä¿ç•™åŸæœ‰å›¾ç‰‡ï¼ˆå¦‚æœæ²¡ä¸Šä¼ æ–°å›¾ï¼‰
                data.posts[index] = {
                    id,
                    title,
                    intro,
                    date,
                    category,
                    imgUrl: imgUrl || data.posts[index].imgUrl
                };
            } else {
                data.posts.unshift({ id, title, intro, date, category, imgUrl });
            }

            await fetch('/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            alert('ä¿å­˜æˆåŠŸ');
            clearForm();
            loadList();
        }

        // ç¼–è¾‘
        async function edit(id) {
            const r = await fetch('/data.json');
            const d = await r.json();
            const item = d.posts.find(x => x.id == id);
            document.getElementById('id').value = item.id;
            document.getElementById('title').value = item.title;
            document.getElementById('intro').value = item.intro;
            document.getElementById('category').value = item.category;

            // é¢„è§ˆåŸæœ‰å›¾ç‰‡
            const preview = document.getElementById('imgPreview');
            if (item.imgUrl) {
                preview.style.backgroundImage = `url(${item.imgUrl})`;
                preview.textContent = '';
            } else {
                preview.style.backgroundImage = '';
                preview.textContent = 'æš‚æ— å›¾ç‰‡';
            }
        }

        // åˆ é™¤
        // async function del(id) {
        //     if (!confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) return;
        //     const r = await fetch('/data.json');
        //     const d = await r.json();
        //     d.posts = d.posts.filter(x => x.id != id);
        //     await fetch('/save', {
        //         method: 'POST',
        //         headers: { 'Content-Type': 'application/json' },
        //         body: JSON.stringify(d)
        //     });
        //     loadList();
        // }


        //////
        // å…¨å±€å˜é‡å­˜å‚¨å½“å‰è¦åˆ é™¤çš„æ–‡ç« ID
        let currentDelId = null;

        // æ˜¾ç¤ºåˆ é™¤å¼¹çª—ï¼ˆæ›¿æ¢åŸæœ‰delå‡½æ•°ï¼‰
        function del(id) {
            currentDelId = id; // ç¼“å­˜è¦åˆ é™¤çš„ID
            // å…ˆæ£€æŸ¥å¼¹çª—æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
            let delModal = document.getElementById('delModal');
            if (!delModal) {
                // åŠ¨æ€åˆ›å»ºå¼¹çª—DOM
                delModal = document.createElement('div');
                delModal.id = 'delModal';
                delModal.className = 'del-modal';
                delModal.innerHTML = `
            <div class="del-modal-content">
                <h3>ç¡®è®¤åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿ</h3>
                <p style="color:#ccc;">åˆ é™¤åå°†æ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼</p>
                <div class="del-modal-btns">
                    <button class="del-modal-btn del-cancel" onclick="hideDelModal()">å–æ¶ˆ</button>
                    <button class="del-modal-btn del-confirm" onclick="confirmDelete()">ç¡®è®¤åˆ é™¤</button>
                </div>
            </div>
        `;
                document.body.appendChild(delModal);
            }
            // æ˜¾ç¤ºå¼¹çª—
            delModal.classList.add('show');
        }

        // éšè—åˆ é™¤å¼¹çª—
        function hideDelModal() {
            const delModal = document.getElementById('delModal');
            if (delModal) delModal.classList.remove('show');
            currentDelId = null; // æ¸…ç©ºç¼“å­˜ID
        }

        // ç¡®è®¤åˆ é™¤æ“ä½œï¼ˆæ ¸å¿ƒåˆ é™¤é€»è¾‘ï¼‰
        async function confirmDelete() {
            if (!currentDelId) return;

            try {
                // è¯»å–åŸæœ‰æ•°æ®
                const r = await fetch('/data.json');
                const d = await r.json();
                // è¿‡æ»¤æ‰è¦åˆ é™¤çš„æ–‡ç« 
                d.posts = d.posts.filter(x => x.id != currentDelId);
                // ä¿å­˜ä¿®æ”¹åçš„æ•°æ®
                await fetch('/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(d)
                });
                // åˆ·æ–°åˆ—è¡¨ + éšè—å¼¹çª—
                loadList();
                hideDelModal();
                alert('åˆ é™¤æˆåŠŸï¼');
            } catch (err) {
                console.error('åˆ é™¤å¤±è´¥:', err);
                alert('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                hideDelModal();
            }
        }

        // åŸæœ‰å…¶ä»–å‡½æ•°ï¼ˆloginã€uploadPostImgã€loadListã€saveã€editã€clearFormã€uploadAvatarï¼‰ä¿æŒä¸å˜
        //////

        
        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('id').value = '';
            document.getElementById('title').value = '';
            document.getElementById('intro').value = '';
            document.getElementById('category').value = 'ç”Ÿæ´»æ—¥å¸¸';
            document.getElementById('postImg').value = '';
            const preview = document.getElementById('imgPreview');
            preview.style.backgroundImage = '';
            preview.textContent = 'æš‚æ— å›¾ç‰‡';
        }

        // ä¸Šä¼ å¤´åƒ
        async function uploadAvatar() {
            const file = document.getElementById('avatar').files[0];
            if (!file) return alert('è¯·é€‰æ‹©å›¾ç‰‡');
            const form = new FormData();
            form.append('avatar', file);
            await fetch('/upload', { method: 'POST', body: form });
            alert('å¤´åƒä¸Šä¼ æˆåŠŸï¼åˆ·æ–°ä¸»é¡µæŸ¥çœ‹');
        }

        // åŠ è½½æ–‡ç« åˆ—è¡¨
        loadList();
    </script>
</body>

</html>